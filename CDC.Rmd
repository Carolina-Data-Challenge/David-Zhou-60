---
title: "CDC"
author: "David Zhou, Erin Greig, Jade Henderson, Robert Gan"
date: "10/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(ggmap)
```
Read in the air pollution data for Durham, NC
```{r}
data <- read_csv('./OpenAQDUrham.csv')
data <-data %>% 
  rename(
    Location = location,
    City = city,
    Country = country,
    Time = utc,
    Local_Time = local,
    Pollutant = parameter,
    Value = value,
    Unit = unit,
    Latitude = latitude,
    Longitude = longitude,
    Etc = attribution
    )
data<- data%>%  separate(Time, c("Date", "Time"), sep = " ") 
data
```

```{r}
data <- select(data, Location, City, Country,Date, Time, Local_Time, Pollutant, Value, Unit, Latitude,Longitude)
data <- data %>% group_by(Pollutant, Value)
noon <- data %>% filter(Time == "12:00:00")
```
Using the dataset that was given, we filtered the data into each each type of pollutant. Then we calculated the average pollution level for each pollutant. 
```{r}
data_pm25 <- data %>% filter(Pollutant == "pm25") %>% filter(Value >= 0)
data_pm10 <- data %>% filter(Pollutant == "pm10")%>% filter(Value >= 0)
data_bc <- data %>% filter(Pollutant == "bc")%>% filter(Value >= 0)
data_co <- data %>% filter(Pollutant == "co")%>% filter(Value >= 0)
data_o3 <- data %>% filter(Pollutant == "o3")%>% filter(Value >= 0)
data_so2 <- data %>% filter(Pollutant == "so2")%>% filter(Value >= 0)
data_no2 <- data %>% filter(Pollutant == "no2")%>% filter(Value >= 0)

means <- c(mean(data_pm25$Value),mean(data_pm10$Value))

pollutants <- c("pm2.5", "pm10")

pollutant <- data.frame(pollutants,means)
pollutant

means_2 <- c(mean(data_bc$Value),mean(data_co$Value),mean(data_o3$Value),mean(data_so2$Value),mean(data_no2$Value))

pollutants_2 <- c("bc", "co", "o3", "so2", "no2")
pollutant_2 <-data.frame(pollutants_2, means_2)
```
We then took the data and created a box plot for each pollutant. Each data point was plotted on a logarithmic scale to adjust the scale of the plots. From the boxplots, it is easy to tell that there are outliers for several of the pollutants. For example, the average pollution level for SO2 and NO2 are very low but there are data points that are three times higher than average or SO2 and almost 100 times higher than average for NO2.

Note: For this dataset, you will notice there is no boxplot present for black carbon. This is because there is no recorded data for black carbom in Durham, NC.
```{r}
a<-ggplot(data_pm25,aes(x = Pollutant, y= Value)) + geom_boxplot() + ylab("µg/m³") + scale_y_log10() + theme_minimal()
b<-ggplot(data_pm10,aes(x = Pollutant, y= Value)) + geom_boxplot() + ylab("µg/m³") + scale_y_log10() + theme_minimal()
c<-ggplot(data_bc,aes(x = Pollutant, y= Value)) + geom_boxplot() +ylab("ppm") + scale_y_log10()+ theme_minimal()
d<-ggplot(data_co,aes(x = Pollutant, y= Value)) + geom_boxplot() +ylab("ppm") + scale_y_log10() + theme_minimal()
e<-ggplot(data_so2,aes(x = Pollutant, y= Value)) + geom_boxplot() +ylab("ppm") + scale_y_log10() + theme_minimal()
f<-ggplot(data_no2,aes(x = Pollutant, y= Value)) + geom_boxplot() +ylab("ppm") +scale_y_log10() + theme_minimal()
g<-ggplot(data_o3,aes(x = Pollutant, y= Value)) + geom_boxplot() +ylab("ppm") +scale_y_log10() +theme_minimal()
figure <- ggarrange(a,b,c,d,e,f,g, ncol = 3, nrow = 3)
figure
```
Next, we plotted the mean pollution levels of the pollutants measured in ppm versus each other. This was compared to national data to assess pollution levels in Durham. 

INCLUDE NATIONAL DATA
```{r}
ggplot(pollutant_2,aes(x = pollutants_2, y= means_2)) + geom_bar(stat = "identity", fill="steelblue") + 
      theme_minimal()
```

```{r}
data_pm10
ggplot(data_pm10, aes(x = Longitude,y = Latitude) )+ geom_point(stat = "identity", fill="steelblue")
```



```{r}
noon_pm25 <- noon %>% filter(Pollutant == "pm25") %>% filter(Value >= 0)
noon_pm10 <- noon %>% filter(Pollutant == "pm10")%>% filter(Value >= 0)
noon_bc <- noon %>% filter(Pollutant == "bc")%>% filter(Value >= 0)
noon_co <- noon %>% filter(Pollutant == "co")%>% filter(Value >= 0)
noon_o3 <- noon %>% filter(Pollutant == "o3")%>% filter(Value >= 0)
noon_so2 <- noon %>% filter(Pollutant == "so2")%>% filter(Value >= 0)
noon_no2 <- noon %>% filter(Pollutant == "no2")%>% filter(Value >= 0)
```


```{r}

ggplot(noon_pm25, aes(x = Date,y = Value)) + geom_point(stat = "identity", fill="steelblue", size = .5)  + theme_minimal() + geom_hline(yintercept = 7.775, color = "blue")+ theme(axis.text.x = element_text(angle = 90))
ggplot(noon_pm10, aes(x = Date,y = Value)) + geom_point(stat = "identity", fill="steelblue", size = .5)  + theme_minimal() + geom_hline(yintercept = 7.775, color = "blue")+ theme(axis.text.x = element_text(angle = 90))
ggplot(noon_co, aes(x = Date,y = Value)) + geom_point(stat = "identity", fill="steelblue", size = .5)  + theme_minimal() + geom_hline(yintercept = 7.775, color = "blue")+ theme(axis.text.x = element_text(angle = 90))
ggplot(noon_o3, aes(x = Date,y = Value)) + geom_point(stat = "identity", fill="steelblue", size = .5)  + theme_minimal() + geom_hline(yintercept = 7.775, color = "blue")+ theme(axis.text.x = element_text(angle = 90))
ggplot(noon_so2, aes(x = Date,y = Value)) + geom_point(stat = "identity", fill="steelblue", size = .5)  + theme_minimal() + geom_hline(yintercept = 7.775, color = "blue")+ theme(axis.text.x = element_text(angle = 90))
ggplot(noon_no2, aes(x = Date,y = Value)) + geom_point(stat = "identity", fill="steelblue", size = .5)  + theme_minimal() + geom_hline(yintercept = 7.775, color = "blue")+ theme(axis.text.x = element_text(angle = 90))

```


